<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SALT Cap Impact in NY-17 | PolicyEngine</title>

    <!-- PolicyEngine Design System Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500&family=Roboto+Serif:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <style>
        /* PolicyEngine Design System Tokens */
        :root {
            /* Primary - Teal */
            --pe-primary-50: #E6FFFA;
            --pe-primary-100: #B2F5EA;
            --pe-primary-200: #81E6D9;
            --pe-primary-300: #4FD1C5;
            --pe-primary-400: #38B2AC;
            --pe-primary-500: #319795;
            --pe-primary-600: #2C7A7B;
            --pe-primary-700: #285E61;
            --pe-primary-800: #234E52;
            --pe-primary-900: #1D4044;

            /* Secondary - Gray */
            --pe-gray-50: #F9FAFB;
            --pe-gray-100: #F2F4F7;
            --pe-gray-200: #E2E8F0;
            --pe-gray-300: #CBD5E1;
            --pe-gray-400: #94A3B8;
            --pe-gray-500: #64748B;
            --pe-gray-600: #475569;
            --pe-gray-700: #344054;
            --pe-gray-800: #1E293B;
            --pe-gray-900: #101828;

            /* Blue */
            --pe-blue-500: #0EA5E9;
            --pe-blue-600: #0284C7;

            /* Semantic */
            --pe-success: #22C55E;
            --pe-warning: #FEC601;
            --pe-error: #EF4444;
            --pe-info: #1890FF;

            /* Background */
            --pe-bg-primary: #FFFFFF;
            --pe-bg-secondary: #F5F9FF;
            --pe-bg-tertiary: #F1F5F9;

            /* Text */
            --pe-text-primary: #000000;
            --pe-text-secondary: #5A5A5A;
            --pe-text-tertiary: #9CA3AF;

            /* Border */
            --pe-border-light: #E2E8F0;
            --pe-border-medium: #CBD5E1;

            /* Shadow */
            --pe-shadow-light: rgba(16, 24, 40, 0.05);
            --pe-shadow-medium: rgba(16, 24, 40, 0.1);

            /* Typography */
            --font-ui: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-body: 'Roboto', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            --font-chart: 'Roboto Serif', Georgia, "Times New Roman", serif;
            --font-mono: 'JetBrains Mono', "Fira Code", Consolas, monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--pe-bg-secondary);
            color: var(--pe-text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--pe-bg-primary);
            border-bottom: 1px solid var(--pe-border-light);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(8px);
        }

        .header img {
            height: 28px;
        }

        .header-text {
            font-family: var(--font-ui);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--pe-text-secondary);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--pe-primary-900) 0%, var(--pe-primary-700) 50%, var(--pe-primary-600) 100%);
            color: white;
            padding: 4rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(79, 209, 197, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(56, 178, 172, 0.1) 0%, transparent 40%);
            pointer-events: none;
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .hero-eyebrow {
            font-family: var(--font-ui);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--pe-primary-200);
            margin-bottom: 1rem;
        }

        .hero h1 {
            font-family: var(--font-chart);
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 600;
            line-height: 1.1;
            margin-bottom: 0.75rem;
            max-width: 800px;
        }

        .hero .subtitle {
            font-family: var(--font-body);
            font-size: 1.25rem;
            font-weight: 400;
            color: var(--pe-primary-100);
            margin-bottom: 2rem;
            max-width: 600px;
        }

        .hero-stat {
            display: inline-flex;
            align-items: baseline;
            gap: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1.25rem 2rem;
            border-radius: 12px;
        }

        .hero-stat-value {
            font-family: var(--font-chart);
            font-size: 3.5rem;
            font-weight: 600;
            color: white;
            line-height: 1;
        }

        .hero-stat-label {
            font-family: var(--font-ui);
            font-size: 1rem;
            font-weight: 500;
            color: var(--pe-primary-100);
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--pe-bg-primary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--pe-border-light);
            box-shadow: 0 1px 3px var(--pe-shadow-light);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--pe-shadow-medium);
        }

        .stat-card.featured {
            border-color: var(--pe-primary-500);
            border-width: 2px;
        }

        .stat-label {
            font-family: var(--font-ui);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--pe-text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-family: var(--font-chart);
            font-size: 2.25rem;
            font-weight: 600;
            color: var(--pe-text-primary);
            line-height: 1.2;
        }

        .stat-value.negative {
            color: var(--pe-error);
        }

        .stat-value.positive {
            color: var(--pe-success);
        }

        .stat-value.teal {
            color: var(--pe-primary-500);
        }

        .stat-context {
            font-family: var(--font-body);
            font-size: 0.875rem;
            color: var(--pe-text-secondary);
            margin-top: 0.5rem;
        }

        /* Slider Section */
        .slider-section {
            background: var(--pe-bg-primary);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--pe-border-light);
            box-shadow: 0 1px 3px var(--pe-shadow-light);
            margin-bottom: 2rem;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .slider-title {
            font-family: var(--font-ui);
            font-weight: 600;
            color: var(--pe-text-primary);
        }

        .slider-value {
            font-family: var(--font-chart);
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--pe-primary-500);
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--pe-gray-200);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--pe-primary-500);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(49, 151, 149, 0.4);
            transition: transform 0.15s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.75rem;
            font-family: var(--font-ui);
            font-size: 0.75rem;
            color: var(--pe-text-tertiary);
        }

        /* Chart Sections */
        .chart-section {
            background: var(--pe-bg-primary);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--pe-border-light);
            box-shadow: 0 1px 3px var(--pe-shadow-light);
            margin-bottom: 2rem;
        }

        .chart-title {
            font-family: var(--font-chart);
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--pe-text-primary);
            margin-bottom: 1.5rem;
        }

        .chart-container {
            width: 100%;
            height: 400px;
        }

        /* People Grid Comparison */
        .comparison-visual {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4rem;
            padding: 2rem;
            flex-wrap: wrap;
        }

        .district-comparison {
            text-align: center;
        }

        .district-name {
            font-family: var(--font-ui);
            font-weight: 600;
            font-size: 1rem;
            color: var(--pe-text-primary);
            margin-bottom: 1.25rem;
        }

        .people-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            width: 220px;
            margin: 0 auto;
        }

        .person {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--pe-gray-200);
            transition: all 0.3s ease;
        }

        .person.loser {
            background: var(--pe-error);
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
        }

        .comparison-arrow {
            font-size: 2rem;
            color: var(--pe-gray-400);
        }

        .grid-label {
            font-family: var(--font-body);
            font-size: 0.875rem;
            color: var(--pe-text-secondary);
            margin-top: 1rem;
        }

        /* Methodology Section */
        .methodology {
            background: var(--pe-bg-primary);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--pe-border-light);
            box-shadow: 0 1px 3px var(--pe-shadow-light);
            margin-top: 2rem;
        }

        .methodology h3 {
            font-family: var(--font-chart);
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--pe-text-primary);
            margin-bottom: 1rem;
        }

        .methodology p {
            font-family: var(--font-body);
            color: var(--pe-text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .methodology a {
            color: var(--pe-primary-500);
            text-decoration: none;
            font-weight: 500;
        }

        .methodology a:hover {
            text-decoration: underline;
        }

        .methodology code {
            font-family: var(--font-mono);
            background: var(--pe-gray-100);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85em;
        }

        /* Code Blocks */
        details {
            margin-top: 1.5rem;
        }

        details summary {
            cursor: pointer;
            font-family: var(--font-ui);
            font-weight: 500;
            color: var(--pe-primary-600);
            padding: 0.75rem 0;
            transition: color 0.15s ease;
        }

        details summary:hover {
            color: var(--pe-primary-500);
        }

        details pre {
            background: var(--pe-gray-900);
            color: #E2E8F0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            line-height: 1.6;
            margin-top: 0.75rem;
        }

        .output-block {
            background: var(--pe-gray-50);
            border: 1px solid var(--pe-border-light);
            padding: 1rem;
            border-radius: 8px;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            overflow-x: auto;
            margin-top: 1rem;
        }

        /* Syntax Highlighting */
        .kw { color: #C586C0; }
        .mod { color: #4EC9B0; }
        .str { color: #CE9178; }
        .num { color: #B5CEA8; }
        .fn { color: #DCDCAA; }
        .cmt { color: #6A9955; }
        .var { color: #9CDCFE; }

        /* Footer */
        .footer {
            text-align: center;
            padding: 3rem 2rem;
            font-family: var(--font-ui);
            font-size: 0.875rem;
            color: var(--pe-text-secondary);
        }

        .footer a {
            color: var(--pe-primary-500);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero {
                padding: 3rem 1.5rem;
            }

            .hero h1 {
                font-size: 1.75rem;
            }

            .hero-stat {
                padding: 1rem 1.5rem;
            }

            .hero-stat-value {
                font-size: 2.5rem;
            }

            .container {
                padding: 2rem 1rem;
            }

            .comparison-visual {
                gap: 2rem;
            }

            .people-grid {
                width: 180px;
            }

            .person {
                width: 14px;
                height: 14px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <img src="https://raw.githubusercontent.com/PolicyEngine/policyengine-app/master/src/images/logos/policyengine/teal.png" alt="PolicyEngine">
        <span class="header-text">Policy Impact Analysis</span>
    </header>

    <section class="hero">
        <div class="hero-content">
            <div class="hero-eyebrow">Congressional District Analysis</div>
            <h1>Cutting the SALT cap to $10,000</h1>
            <p class="subtitle">How Rep. Mike Lawler's NY-17 constituents would be affected compared to the national average</p>
            <div class="hero-stat">
                <span class="hero-stat-value" id="main-stat">19.1%</span>
                <span class="hero-stat-label">of NY-17 residents<br>would lose money</span>
            </div>
        </div>
    </section>

    <div class="container">
        <section class="stats-grid">
            <div class="stat-card featured">
                <div class="stat-label">Share who would lose</div>
                <div class="stat-value negative" id="loser-share">19.1%</div>
                <div class="stat-context" id="loser-context">vs 8.0% nationally (2.4× higher)</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Average change per person</div>
                <div class="stat-value negative" id="avg-loss">−$476</div>
                <div class="stat-context">Across all district residents</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Average loss among losers</div>
                <div class="stat-value negative" id="avg-loss-losers">−$2,496</div>
                <div class="stat-context">For those who are affected</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total district impact</div>
                <div class="stat-value negative" id="total-impact">−$282M</div>
                <div class="stat-context">Annual change</div>
            </div>
        </section>

        <section class="slider-section">
            <div class="slider-header">
                <span class="slider-title">Adjust SALT cap level</span>
                <span class="slider-value" id="cap-display">$10,000</span>
            </div>
            <input type="range" id="salt-slider" min="0" max="40400" step="5000" value="10000">
            <div class="range-labels">
                <span>$0 (eliminate)</span>
                <span>$40,400 (2026 baseline)</span>
            </div>
        </section>

        <section class="chart-section">
            <h2 class="chart-title">NY-17 vs national comparison</h2>
            <div class="comparison-visual">
                <div class="district-comparison">
                    <div class="district-name">NY-17 (Lawler)</div>
                    <div class="people-grid" id="ny17-grid"></div>
                    <div class="grid-label"><span id="ny17-count">19</span> out of 100 lose</div>
                </div>
                <div class="comparison-arrow">→</div>
                <div class="district-comparison">
                    <div class="district-name">National average</div>
                    <div class="people-grid" id="national-grid"></div>
                    <div class="grid-label"><span id="national-count">8</span> out of 100 lose</div>
                </div>
            </div>
        </section>

        <section class="chart-section">
            <h2 class="chart-title">Impact by income level in NY-17</h2>
            <div id="income-chart" class="chart-container"></div>
        </section>

        <section class="chart-section">
            <h2 class="chart-title">Share losing by SALT cap level</h2>
            <div id="cap-chart" class="chart-container"></div>
        </section>

        <section class="methodology">
            <h3>Methodology</h3>
            <p>
                This analysis uses <a href="https://policyengine.org" target="_blank">PolicyEngine's</a>
                microsimulation model with district-level data for NY-17. The model calculates how
                reducing the SALT (State and Local Tax) deduction cap from the 2026 baseline of ~$40,400
                to $10,000 would affect household net income.
            </p>
            <p>
                Data is based on the enhanced Current Population Survey with geographic targeting to
                congressional districts. The 2026 baseline assumes the TCJA SALT cap is extended and
                indexed for inflation.
            </p>
            <p>
                <a href="https://policyengine.org/us/policy?focus=gov.irs.deductions.itemized.salt_and_real_estate.cap" target="_blank">
                    Explore this policy on PolicyEngine →
                </a>
            </p>
        </section>

        <section class="methodology">
            <h3>Appendix: Python code</h3>
            <p>Install PolicyEngine with <code>pip install policyengine-us</code>, then run:</p>

            <details>
                <summary>Click to expand main analysis code</summary>
                <pre><code><span class="kw">from</span> <span class="mod">policyengine_us</span> <span class="kw">import</span> Microsimulation
<span class="kw">from</span> <span class="mod">policyengine_core.reforms</span> <span class="kw">import</span> Reform

<span class="cmt"># 1. Load district data for NY-17 (Mike Lawler's district)</span>
district = <span class="str">"NY-17"</span>
baseline = Microsimulation(
    dataset=<span class="str">f'hf://policyengine/policyengine-us-data/districts/{district}.h5'</span>
)

<span class="cmt"># 2. Define reform - cut SALT cap to $10k</span>
<span class="cmt"># Note: For caps below $10k, also set the high-earner floor parameter</span>
<span class="cmt"># (phase_out.floor.amount) to match, otherwise the $10k floor for</span>
<span class="cmt"># AGI > $505k prevents the lower cap from binding.</span>
reform = Reform.from_dict({
    <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.SINGLE'</span>: {
        <span class="str">'2026-01-01.2100-12-31'</span>: <span class="num">10_000</span>
    },
    <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.JOINT'</span>: {
        <span class="str">'2026-01-01.2100-12-31'</span>: <span class="num">10_000</span>
    },
    <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.SEPARATE'</span>: {
        <span class="str">'2026-01-01.2100-12-31'</span>: <span class="num">5_000</span>
    },
    <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.HEAD_OF_HOUSEHOLD'</span>: {
        <span class="str">'2026-01-01.2100-12-31'</span>: <span class="num">10_000</span>
    },
    <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.SURVIVING_SPOUSE'</span>: {
        <span class="str">'2026-01-01.2100-12-31'</span>: <span class="num">10_000</span>
    },
}, <span class="str">'policyengine_us'</span>)

reformed = Microsimulation(
    dataset=<span class="str">f'hf://policyengine/policyengine-us-data/districts/{district}.h5'</span>,
    reform=reform
)

<span class="cmt"># 3. Calculate impact - MicroSeries handles weights automatically</span>
baseline_income = baseline.calc(<span class="str">'household_net_income'</span>, period=<span class="num">2026</span>, map_to=<span class="str">'person'</span>)
reformed_income = reformed.calc(<span class="str">'household_net_income'</span>, period=<span class="num">2026</span>, map_to=<span class="str">'person'</span>)
change = reformed_income - baseline_income

<span class="cmt"># 4. Results</span>
loser_share = (change &lt; <span class="num">0</span>).mean()
avg_change = change.mean()
avg_loss_among_losers = change[change &lt; <span class="num">0</span>].mean()
total_impact = change.sum()

<span class="fn">print</span>(<span class="str">f"Share who would LOSE: {loser_share:.1%}"</span>)
<span class="fn">print</span>(<span class="str">f"Average change per person: ${avg_change:,.0f}"</span>)
<span class="fn">print</span>(<span class="str">f"Average loss among losers: ${avg_loss_among_losers:,.0f}"</span>)
<span class="fn">print</span>(<span class="str">f"Total fiscal impact: ${total_impact/1e9:,.2f}B"</span>)

<span class="cmt"># 5. Compare to national</span>
national_baseline = Microsimulation()
national_reformed = Microsimulation(reform=reform)

national_change = (
    national_reformed.calc(<span class="str">'household_net_income'</span>, period=<span class="num">2026</span>, map_to=<span class="str">'person'</span>) -
    national_baseline.calc(<span class="str">'household_net_income'</span>, period=<span class="num">2026</span>, map_to=<span class="str">'person'</span>)
)

<span class="fn">print</span>(<span class="str">f"NY-17 share losing: {loser_share:.1%}"</span>)
<span class="fn">print</span>(<span class="str">f"National share losing: {(national_change < 0).mean():.1%}"</span>)</code></pre>
            </details>

            <p style="margin-top: 1rem;"><strong>Output:</strong></p>
            <pre class="output-block">Share who would LOSE: 19.1%
Average change per person: $-476
Average loss among losers: $-2,496
Total fiscal impact: $-0.28B

NY-17 share losing: 19.1%
National share losing: 8.0%</pre>

            <details>
                <summary>Code for "Share losing by SALT cap level" chart</summary>
                <pre><code><span class="kw">import</span> <span class="mod">plotly.graph_objects</span> <span class="kw">as</span> go
<span class="kw">from</span> <span class="mod">policyengine_us</span> <span class="kw">import</span> Microsimulation
<span class="kw">from</span> <span class="mod">policyengine_core.reforms</span> <span class="kw">import</span> Reform

district = <span class="str">"NY-17"</span>
cap_levels = [<span class="num">0</span>, <span class="num">5_000</span>, <span class="num">10_000</span>, <span class="num">15_000</span>, <span class="num">20_000</span>, <span class="num">25_000</span>, <span class="num">30_000</span>, <span class="num">40_000</span>, <span class="num">50_000</span>]

ny17_results = []
national_results = []

<span class="kw">for</span> cap <span class="kw">in</span> cap_levels:
    <span class="cmt"># Define reform for this cap level</span>
    reform = Reform.from_dict({
        <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.SINGLE'</span>: {
            <span class="str">'2026-01-01.2100-12-31'</span>: cap
        },
        <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.JOINT'</span>: {
            <span class="str">'2026-01-01.2100-12-31'</span>: cap
        },
        <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.SEPARATE'</span>: {
            <span class="str">'2026-01-01.2100-12-31'</span>: cap // <span class="num">2</span>
        },
        <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.HEAD_OF_HOUSEHOLD'</span>: {
            <span class="str">'2026-01-01.2100-12-31'</span>: cap
        },
        <span class="str">'gov.irs.deductions.itemized.salt_and_real_estate.cap.SURVIVING_SPOUSE'</span>: {
            <span class="str">'2026-01-01.2100-12-31'</span>: cap
        },
    }, <span class="str">'policyengine_us'</span>)

    <span class="cmt"># NY-17 district</span>
    baseline_d = Microsimulation(
        dataset=<span class="str">f'hf://policyengine/policyengine-us-data/districts/{district}.h5'</span>
    )
    reformed_d = Microsimulation(
        dataset=<span class="str">f'hf://policyengine/policyengine-us-data/districts/{district}.h5'</span>,
        reform=reform
    )
    change_d = (
        reformed_d.calc(<span class="str">'household_net_income'</span>, period=<span class="num">2026</span>, map_to=<span class="str">'person'</span>) -
        baseline_d.calc(<span class="str">'household_net_income'</span>, period=<span class="num">2026</span>, map_to=<span class="str">'person'</span>)
    )
    ny17_results.append(<span class="fn">float</span>((change_d &lt; <span class="num">0</span>).mean() * <span class="num">100</span>))

    <span class="cmt"># National</span>
    baseline_n = Microsimulation()
    reformed_n = Microsimulation(reform=reform)
    change_n = (
        reformed_n.calc(<span class="str">'household_net_income'</span>, period=<span class="num">2026</span>, map_to=<span class="str">'person'</span>) -
        baseline_n.calc(<span class="str">'household_net_income'</span>, period=<span class="num">2026</span>, map_to=<span class="str">'person'</span>)
    )
    national_results.append(<span class="fn">float</span>((change_n &lt; <span class="num">0</span>).mean() * <span class="num">100</span>))

<span class="cmt"># Create the chart</span>
fig = go.Figure()

fig.add_trace(go.Scatter(
    x=[<span class="str">f'${c//1000}k'</span> <span class="kw">for</span> c <span class="kw">in</span> cap_levels],
    y=ny17_results,
    name=<span class="str">'NY-17 (Lawler)'</span>,
    mode=<span class="str">'lines+markers'</span>,
    line=<span class="fn">dict</span>(color=<span class="str">'#EF4444'</span>, width=<span class="num">3</span>),
    marker=<span class="fn">dict</span>(size=<span class="num">8</span>)
))

fig.add_trace(go.Scatter(
    x=[<span class="str">f'${c//1000}k'</span> <span class="kw">for</span> c <span class="kw">in</span> cap_levels],
    y=national_results,
    name=<span class="str">'National'</span>,
    mode=<span class="str">'lines+markers'</span>,
    line=<span class="fn">dict</span>(color=<span class="str">'#319795'</span>, width=<span class="num">3</span>),
    marker=<span class="fn">dict</span>(size=<span class="num">8</span>)
))

<span class="cmt"># Add vertical line at $10k</span>
fig.add_vline(x=<span class="str">'$10k'</span>, line_dash=<span class="str">'dot'</span>, line_color=<span class="str">'gray'</span>,
              annotation_text=<span class="str">'Proposed $10k cap'</span>)

fig.update_layout(
    title=<span class="str">'Share losing by SALT cap level'</span>,
    xaxis_title=<span class="str">'SALT cap level'</span>,
    yaxis_title=<span class="str">'Share who would lose (%)'</span>,
    yaxis_range=[<span class="num">0</span>, <span class="num">40</span>],
    font=<span class="fn">dict</span>(family=<span class="str">'Roboto Serif, Georgia, serif'</span>),
    plot_bgcolor=<span class="str">'white'</span>,
    legend=<span class="fn">dict</span>(x=<span class="num">0.7</span>, y=<span class="num">0.95</span>)
)

fig.show()</code></pre>
            </details>
        </section>
    </div>

    <footer class="footer">
        Built with <a href="https://policyengine.org" target="_blank">PolicyEngine</a> ·
        <a href="https://github.com/PolicyEngine/salt-cap-ny17" target="_blank">View source</a>
    </footer>

    <script>
        // PolicyEngine computed data
        // Note: 2026 baseline SALT cap is $40,400 (indexed from TCJA's $10k)
        // For $0 and $5k, we also set the high-earner floor to match the cap
        // (otherwise the $10k floor for AGI>$505k would prevent the cap from binding)
        const impactData = {
            0: { ny17: 33.8, national: 16.5, avgLoss: -924, avgLossAmongLosers: -2741, totalImpact: -548 },
            5000: { ny17: 31.3, national: 12.5, avgLoss: -695, avgLossAmongLosers: -2226, totalImpact: -412 },
            10000: { ny17: 19.1, national: 8.0, avgLoss: -476, avgLossAmongLosers: -2496, totalImpact: -282 },
            15000: { ny17: 13.8, national: 6.1, avgLoss: -419, avgLossAmongLosers: -3043, totalImpact: -248 },
            20000: { ny17: 12.4, national: 4.7, avgLoss: -318, avgLossAmongLosers: -2564, totalImpact: -188 },
            25000: { ny17: 9.1, national: 3.7, avgLoss: -221, avgLossAmongLosers: -2434, totalImpact: -131 },
            30000: { ny17: 8.5, national: 2.3, avgLoss: -134, avgLossAmongLosers: -1579, totalImpact: -79 },
            35000: { ny17: 6.1, national: 1.2, avgLoss: -67, avgLossAmongLosers: -1106, totalImpact: -40 },
            40400: { ny17: 0.0, national: 0.0, avgLoss: 0, avgLossAmongLosers: 0, totalImpact: 0 },
        };

        const incomeLabels = ["Under $25k", "$25k-$50k", "$50k-$75k", "$75k-$100k", "$100k-$150k", "$150k-$200k", "$200k+"];

        // Income breakdown by cap level
        const incomeDataByCap = {
            0: [0.0, 0.0, 0.0, 6.0, 2.5, 5.2, 69.1],
            5000: [0.0, 0.0, 0.0, 1.1, 2.4, 5.2, 64.6],
            10000: [0.0, 0.0, 0.0, 0.0, 0.2, 1.6, 39.7],
            15000: [0.0, 0.0, 0.0, 0.0, 0.2, 0.0, 28.7],
            20000: [0.0, 0.0, 0.0, 0.0, 0.2, 0.0, 25.8],
            25000: [0.0, 0.0, 0.0, 0.0, 0.2, 0.0, 18.7],
            30000: [0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 17.6],
            35000: [0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 13.1],
            40400: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        };

        // Chart font config using PolicyEngine design system
        const chartFont = { family: 'Roboto Serif, Georgia, serif', color: '#344054' };

        function createPeopleGrid(containerId, loserCount) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for (let i = 0; i < 100; i++) {
                const person = document.createElement('div');
                person.className = 'person' + (i < loserCount ? ' loser' : '');
                container.appendChild(person);
            }
        }

        function formatCurrency(val) {
            if (val >= 0) return '$' + val.toLocaleString();
            return '−$' + Math.abs(val).toLocaleString();
        }

        function updateDisplay(cap) {
            const caps = Object.keys(impactData).map(Number).sort((a, b) => a - b);
            let closestCap = caps.reduce((prev, curr) =>
                Math.abs(curr - cap) < Math.abs(prev - cap) ? curr : prev
            );

            const data = impactData[closestCap];
            const ratio = data.national > 0 ? (data.ny17 / data.national).toFixed(1) : 'N/A';

            document.getElementById('cap-display').textContent = '$' + cap.toLocaleString();
            document.getElementById('main-stat').textContent = data.ny17.toFixed(1) + '%';
            document.getElementById('loser-share').textContent = data.ny17.toFixed(1) + '%';
            document.getElementById('loser-context').textContent =
                data.national > 0 ? `vs ${data.national.toFixed(1)}% nationally (${ratio}× higher)` : 'Same as national';

            document.getElementById('avg-loss').textContent = formatCurrency(data.avgLoss);
            document.getElementById('avg-loss').className = 'stat-value ' + (data.avgLoss < 0 ? 'negative' : 'positive');

            document.getElementById('avg-loss-losers').textContent = formatCurrency(data.avgLossAmongLosers);

            document.getElementById('total-impact').textContent = formatCurrency(data.totalImpact) + 'M';
            document.getElementById('total-impact').className = 'stat-value ' + (data.totalImpact < 0 ? 'negative' : 'positive');

            document.getElementById('ny17-count').textContent = Math.round(data.ny17);
            document.getElementById('national-count').textContent = Math.round(data.national);

            createPeopleGrid('ny17-grid', Math.round(data.ny17));
            createPeopleGrid('national-grid', Math.round(data.national));
        }

        function updateIncomeChart(cap) {
            const caps = Object.keys(incomeDataByCap).map(Number).sort((a, b) => a - b);
            let closestCap = caps.reduce((prev, curr) =>
                Math.abs(curr - cap) < Math.abs(prev - cap) ? curr : prev
            );

            const loserPct = incomeDataByCap[closestCap];
            const maxVal = Math.max(...loserPct, 50);

            Plotly.react('income-chart', [{
                x: incomeLabels,
                y: loserPct,
                type: 'bar',
                marker: {
                    color: loserPct.map(v => v > 30 ? '#EF4444' : v > 10 ? '#F97316' : '#319795')
                },
                text: loserPct.map(v => v > 0 ? v.toFixed(1) + '%' : ''),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>%{y:.1f}% would lose<extra></extra>'
            }], {
                font: chartFont,
                margin: { t: 30, r: 20, b: 80, l: 60 },
                xaxis: { title: 'Household income', tickangle: -30 },
                yaxis: { title: 'Share who would lose (%)', range: [0, Math.max(maxVal * 1.15, 10)] },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
            }, { responsive: true, displayModeBar: false });
        }

        // Initialize
        const slider = document.getElementById('salt-slider');
        slider.addEventListener('input', (e) => {
            const cap = parseInt(e.target.value);
            updateDisplay(cap);
            updateIncomeChart(cap);
        });

        createPeopleGrid('ny17-grid', 19);
        createPeopleGrid('national-grid', 8);

        // Initial income chart
        updateIncomeChart(10000);

        // Cap comparison chart
        const capLevels = Object.keys(impactData).map(Number).sort((a, b) => a - b);

        Plotly.newPlot('cap-chart', [{
            x: capLevels.map(c => '$' + (c/1000) + 'k'),
            y: capLevels.map(c => impactData[c].ny17),
            name: 'NY-17 (Lawler)',
            type: 'scatter',
            mode: 'lines+markers',
            line: { color: '#EF4444', width: 3 },
            marker: { size: 8 }
        }, {
            x: capLevels.map(c => '$' + (c/1000) + 'k'),
            y: capLevels.map(c => impactData[c].national),
            name: 'National',
            type: 'scatter',
            mode: 'lines+markers',
            line: { color: '#319795', width: 3 },
            marker: { size: 8 }
        }], {
            font: chartFont,
            margin: { t: 30, r: 20, b: 60, l: 60 },
            xaxis: { title: 'SALT cap level' },
            yaxis: { title: 'Share who would lose (%)', range: [0, 40] },
            plot_bgcolor: 'white',
            paper_bgcolor: 'white',
            legend: { x: 0.7, y: 0.95 },
            shapes: [{
                type: 'line',
                x0: '$10k',
                x1: '$10k',
                y0: 0,
                y1: 40,
                line: { color: '#94A3B8', width: 2, dash: 'dot' }
            }],
            annotations: [{
                x: '$10k',
                y: 36,
                text: 'Proposed<br>$10k cap',
                showarrow: false,
                font: { size: 10, color: '#64748B' }
            }]
        }, { responsive: true, displayModeBar: false });
    </script>
</body>
</html>
